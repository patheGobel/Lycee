name: Deploy Existing PDFs to Docs

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  move_and_deploy:
    runs-on: ubuntu-latest
    
    steps:
      # √âtape 1 : R√©cup√©rer le code du d√©p√¥t
      - name: Checkout repository
        uses: actions/checkout@v4

      # √âtape 2 : Pr√©parer le dossier docs/
      - name: Setup docs directory
        run: |
          echo "Pr√©paration du dossier docs/pdf..."
          mkdir -p docs/pdf
          touch docs/.nojekyll

      # √âtape 3 : Rechercher et d√©placer les fichiers PDF
      - name: Locate and Move Final PDFs
        run: |
          echo "Recherche et d√©placement des fichiers PDF..."
          
          # Recherche r√©cursive des fichiers PDF dans tous les dossiers nomm√©s 'build'
          find . -type f -path "*/build/*.pdf" -print -exec mv {} docs/pdf/ \;
          
          echo "Liste des fichiers d√©plac√©s :"
          ls -l docs/pdf/

      # √âtape 4 : V√©rifier qu‚Äôil y a bien des fichiers √† d√©ployer
      - name: Verify PDFs presence
        run: |
          if [ -z "$(ls -A docs/pdf)" ]; then
            echo "Aucun fichier PDF trouv√© √† d√©ployer. Annulation."
            exit 1
          fi

      # √âtape 5 : D√©ployer sur GitHub Pages
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        if: success()
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./docs
          commit_message: "üöÄ Deploy updated PDFs to GitHub Pages"