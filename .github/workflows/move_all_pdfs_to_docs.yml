name: Gather and Deploy All PDFs

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  gather_and_deploy:
    runs-on: ubuntu-latest

    steps:
      # √âtape 1 : R√©cup√©rer le code du d√©p√¥t
      - name: Checkout repository
        uses: actions/checkout@v4

      # √âtape 2 : Cr√©er le dossier docs/pdf et d√©sactiver Jekyll
      - name: Setup docs directory
        run: |
          echo "Cr√©ation du dossier docs/pdf..."
          mkdir -p docs/pdf
          touch docs/.nojekyll

      # √âtape 3 : Trouver et d√©placer les fichiers PDF
      - name: Locate and Move All PDFs
        run: |
          echo "Recherche et d√©placement des fichiers PDF..."

          # D√©place tous les fichiers PDF sauf ceux d√©j√† dans docs/pdf/
          find . -type f -name "*.pdf" ! -path "./docs/pdf/*" -exec mv -v {} docs/pdf/ \;

          echo "Contenu final du dossier docs/pdf :"
          ls -l docs/pdf/

      # √âtape 4 : V√©rifier qu‚Äôil y a bien des PDF avant de d√©ployer
      - name: Check if PDFs exist
        run: |
          if [ -z "$(ls -A docs/pdf)" ]; then
            echo "‚ö†Ô∏è Aucun fichier PDF trouv√© ‚Äî le d√©ploiement sera annul√©."
            exit 1
          fi

      # √âtape 5 : D√©ployer sur GitHub Pages
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        if: success()
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./docs
          commit_message: "üöÄ D√©ploiement automatique des fichiers PDF"
